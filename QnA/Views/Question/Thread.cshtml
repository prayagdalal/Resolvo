@model QnA.ViewModels.QuestionViewModel
@{
    ViewBag.Title = "Add";
    Layout = "~/Views/Shared/ClientMaster.cshtml";
}
<head>
    <!-- thred style-->
    <link href="~/Content/css/thread/custom.css" rel="stylesheet">
    <link href="~/Content/css/thread/vars.css" rel="stylesheet">
    <style>
        .x_panel {
            background: none;
            border:0;
        }
        .author-image-span {
            border-color: #397df8;
        }
        img.avatar{
            padding:0;

            width:45px;
            height:45px;
        }
        .comment-form{
            padding:0;
        }
        hr{
            margin:0;
        }
        .question-footer{
            padding:10px;
        }
        .post-author {
            letter-spacing: 0px
        }
        .best-answer-meta{
            cursor:pointer;
        }
        .fupvote, .tupvote, .fdownvote, .tdownvote {
            margin-bottom: 0px;
            margin-right: 0px;
            background-color: transparent;
            border: 0;
            padding: 0;
        }
        .fupvote i, .tupvote i, .fdownvote i, .tdownvote i {
             font-size: 2rem;
        }
        .footer-meta li {
            padding:0;
            padding-left: 5px;
            padding-right: 5px;
        }
        .commentbox{
            display:none;
        }
    </style>
</head>
<div class="row">
    <div class="col-md-12">
        <div class="x_panel">

            <div class="x_content">
                <div class="col-md-9 col-sm-9  ">
                    <div class="the-main-inner float_l">
                        <div class="post-articles question-articles">
                            <article id="post-118" class="article-question article-post clearfix question-with-comments answer-question-not-jquery question-vote-image discoura-not-credential question-type-normal post-118 question type-question status-publish hentry question-category-language question_tags-english question_tags-language" itemprop="mainEntity" itemscope="" itemtype="https://schema.org/Question">
                                <div class="single-inner-content">
                                    <div class="question-inner">
                                        <div class="question-image-vote">
                                            <div class="author-image author-image-42">
                                                <a href="">
                                                    <span class="author-image-span">
                                                        <img class="avatar avatar-42 photo" alt="Martin Hope" title="Martin Hope" width="42" height="42" src="https://2code.info/demo/themes/Discy/Main/wp-content/uploads/2018/04/team-2-42x42.jpg">
                                                    </span>
                                                </a>
                                            </div>
                                            <ul class="question-vote question-mobile">
                                                <li class="question-vote-up"><a href="#" id="question_vote_up-118" data-type="question" data-vote-type="up" class="wpqa_vote question_vote_up vote_allow" title="Like"><i class="icon-up-dir"></i></a></li>
                                                <li class="vote_result" itemprop="upvoteCount">126</li>
                                                <li class="li_loader"><span class="loader_3 fa-spin"></span></li>
                                                <li class="question-vote-down"><a href="#" id="question_vote_down-118" data-type="question" data-vote-type="down" class="wpqa_vote question_vote_down vote_allow wpqa_voted_already" title="Dislike"><i class="icon-down-dir"></i></a></li>
                                            </ul>
                                        </div>
                                        <div class="question-content question-content-first">
                                            <header class="article-header">
                                                <div class="question-header">
                                                    <span itemprop="author">
                                                        <a class="post-author" itemprop="url" href="">
                                                        <span itemprop="name">@Model.forum.User.Name</span></a>
                                                    </span>
                                                    <div class="post-meta">
                                                        <span class="post-date" style="margin-top: 3px;">
                                                            Asked:<span class="date-separator"></span>
                                                            <time class="entry-date published">April 19, 2018</time></span>
                                                    </div>
                                                </div>
                                            </header>
                                            <div itemprop="name">
                                                <h1 class="post-title">@Model.forum.Title</h1>
                                            </div>
                                        </div>
                                        <div class="question-not-mobile question-image-vote question-vote-sticky">
                                            <div class="">
                                                <ul class="question-vote">
                                                    <li class="question-vote-up"><button id="@("fupvote"+Model.forum.Id)" updateid="@("fupvote-"+Model.forum.Id)" class="fupvote" title="upvote"><i class="icon-up-dir"></i></button></li>
                                                    @{
                                                        var forumVotes = Model.forum.Upvote - Model.forum.Downvote;

                                                    }
                                                    <li class="vote_result" itemprop="upvoteCount">@forumVotes</li>
                                                    <li class="li_loader"><span class="loader_3 fa-spin"></span></li>
                                                    <li class="question-vote-down"><button id="@("fdownvote"+Model.forum.Id)" updateid="@("fdownvote-"+Model.forum.Id)"  class="fdownvote" title="downvote"><i class="icon-down-dir"></i></button></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="question-content question-content-second">
                                            <div class="wpqa_error"></div>
                                            <div class="wpqa_success"></div>
                                            <div class="post-wrap-content">
                                                <div class="question-content-text">
                                                    <div class="all_signle_post_content">
                                                        <div class="content-text" itemprop="text">
                                                            @Model.forum.Body
                                                        </div>
                                                        <div class="clearfix"></div>
                                                        <div></div>
                                                    </div>
                                                </div>
                                                <div class="tagcloud">
                                                    <div class="question-tags">
                                                        @foreach (var data in Model.forum.tags)
                                                        {
                                                            <a href="" style="background: #e1ecf4;color:#39739d">@data.Tag.Name</a>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                            @{
                                                if (Model.Id == Model.forum.UserId)
                                                {
                                                    <div class="question-footer">
                                                        <ul class="footer-meta">
                                                            <li class="best-answer-meta"><span class="editforum question-span" updateid="@Model.forum.Id">Edit</span></li>
                                                            <li class="best-answer-meta"><span class="deleteforum question-span" updateid="@Model.forum.Id">Delete</span></li>
                                                        </ul>
                                                        <a class="meta-answer meta-answer-a" href="">Answer</a>
                                                    </div>
                                                }

                                            }

                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                </div>
                                <div class="question-adv-comments question-has-comments">

                                    @if (Model.threadList.Count != 0)
                                    {
                                        <div id="comments" class="post-section comments-popup-share">
                                            <div class="post-inner">
                                                <div class="answers-tabs">
                                                    <h2 class="section-title" style="font-size:20px"><span>@Model.threadList.Count Answers</span></h2>
                                                    <div class="answers-tabs-inner">
                                                        <ul>
                                                            <li class="active-tab"><a href="">Voted</a></li>
                                                            <li><a href="">Oldest</a></li>
                                                            <li><a href="">Recent</a></li>
                                                            <li><a href="">Random</a></li>
                                                        </ul>
                                                    </div>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <ol class="commentlist clearfix">
                                                    @foreach (var data in Model.threadList)
                                                    {
                                                        <li class="comment byuser comment-author-marko even thread-even depth-1" itemscope="" id="li-comment-64">
                                                            <div class="single-inner-content">
                                                                <div class="question-inner">
                                                                    <div class="question-image-vote">
                                                                        <div class="author-image author-image-42">
                                                                            <a href="">
                                                                                <span class="author-image-span">
                                                                                    <img class="avatar avatar-42 photo" alt="Martin Hope" title="Martin Hope" width="42" height="42" src="https://2code.info/demo/themes/Discy/Main/wp-content/uploads/2018/04/team-2-42x42.jpg">
                                                                                </span>
                                                                            </a>
                                                                        </div>
                                                                        <ul class="question-vote question-mobile">
                                                                            <li class="question-vote-up"><a href="#" id="question_vote_up-118" data-type="question" data-vote-type="up" class="wpqa_vote question_vote_up vote_allow" title="Like"><i class="icon-up-dir"></i></a></li>
                                                                          
                                                                            <li class="vote_result" itemprop="upvoteCount">126</li>
                                                                            <li class="li_loader"><span class="loader_3 fa-spin"></span></li>
                                                                            <li class="question-vote-down"><a href="#" id="question_vote_down-118" data-type="question" data-vote-type="down" class="wpqa_vote question_vote_down vote_allow wpqa_voted_already" title="Dislike"><i class="icon-down-dir"></i></a></li>
                                                                        </ul>
                                                                    </div>
                                                                    <header class="article-header">
                                                                        <div class="question-header">
                                                                            <span itemprop="author">
                                                                                <a class="post-author" itemprop="url" href=""><span itemprop="name">@data.User.Name</span></a>
                                                                            </span>

                                                                        </div>
                                                                        <span href="" class="comment-date" itemprop="url">
                                                                            Added an answer on April 19, 2018
                                                                        </span>
                                                                    </header>
                                                                    <div class="question-not-mobile question-image-vote question-vote-sticky">
                                                                        <div class="">
                                                                            <ul class="question-vote">
                                                                            <li class="question-vote-up"><button  id="@("tupvote"+data.Id)" updateid="@("tupvote-"+data.Id)" class="tupvote" title="Like"><i class="icon-up-dir"></i></button></li>
                                                                                @{
                                                                                    var threadVotes = data.Upvote - data.Downvote;

                                                                                }
                                                                            <li class="vote_result" itemprop="upvoteCount">@threadVotes</li>
                                                                                <li class="li_loader"><span class="loader_3 fa-spin"></span></li>
                                                                                <li class="question-vote-down"><button id="@("tdownvote"+data.Id)" updateid="@("tdownvote-"+data.Id)" class="tdownvote" title="Dislike"><i class="icon-down-dir"></i></button></li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                    <div class="question-content question-content-second">
                                                                        <div class="wpqa_error"></div>
                                                                        <div class="wpqa_success"></div><br>
                                                                        <div class="post-wrap-content">
                                                                            <div class="question-content-text">
                                                                                <div class="text">
                                                                                    <div itemprop="text" style="color:black">
                                                                                        @Html.Raw(WebUtility.HtmlDecode(data.Body))
                                                                                    </div>
                                                                                    @{
                                                                                        if (Model.Id == data.UserId)
                                                                                        {
                                                                                            <ul class="footer-meta">

                                                                                                <li class="best-answer-meta"><span class="editthread question-span" updateid="@data.Id">Edit</span></li>
                                                                                                <li class="best-answer-meta"><span class="deletethread question-span" updateid="@data.Id">Delete</span></li>
                                                                                            </ul>
                                                                                        }
                                                                                    }

                                                                                    <div class="clearfix"></div>
                                                                                    <div class="clearfix"></div>
                                                                                    <div class="wpqa_error"></div>
                                                                                    @*       <ul class="comment-reply comment-reply-main">
            <li><sapn style="font-size:0.8rem;font-weight:bold"><a href="" data-id="63" data-post_id="118"> 5 comments</a></sapn></li>
            <li class="clearfix last-item-answers"></li>
        </ul>*@

                                                                                    <div class="question-footer" id="@("commentlist"+data.Id)" style="margin-top:0.5rem">
                                                                                        @foreach (var cmt in data.CommentList)
                                                                                        {
                                                                                        <div id="@("commentrow" + cmt.Id)">
                                                                                            @cmt.Body -<a href="">@cmt.User.Name</a>
                                                                                            @{
                                                                                                if (Model.Id == cmt.UserId)
                                                                                                {
                                                                                                    <a href="javascript:void(0)" class="deletecomment" updateid="@cmt.Id">Delete</a>
                                                                                                }
                                                                                             }
                                                                                                </div><hr>
                                                                                        }

                                                                                        <sapn style="font-size:0.8rem;"><a href="javascript:void(0)" class="opencommentbox" updateid="@data.Id"> add a comment</a></sapn><br />
                                                                                        <div id="@("commentbox"+data.Id)" class="commentbox">
                                                                                        <textarea class="form-control" id="@("commentinput"+data.Id)"></textarea>
                                                                                        <a class="addcomment meta-answer meta-answer-a" updateid="@data.Id" style=" padding: 5px; letter-spacing: 0;" href="javascript:void(0)">Add Comment</a>
                                                                                        <a class="cancelcomment meta-answer meta-answer-a" updateid="@data.Id" style="float:right; padding: 5px; margin-right:5px" href="javascript:void(0)">cancel</a>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>

                                                    }

                                                </ol>
                                                <div class="clearfix"></div>
                                            </div>
                                        </div>

                                    }


                                    <div id="respond-all">
                                        <div id="respond" class="comment-respond">
                                            <h3 class="section-title comment-form-hide" style="display: block;">
                                                Leave an answer
                                            </h3>
                                            
                                                <div class="clearfix"></div>
                                                <div class="wpqa_error"></div>
                                                <div class="form-input form-textarea form-comment-editor">
                                                    <div style="height: 250px;" id="body">

                                                    </div>
                                                </div>
                                                <p class="form-submit">
                                                    <button id="postanswer" class="button-default button-hide-click" style="width:100%">Post Your Answer</button>
                                                </p>
                                                <input type="hidden" id="ak_js" name="ak_js" value="1609535191671">
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </div>


                </div>

                <!-- start project-detail sidebar -->
                <div class="col-md-3 col-sm-3  ">

                    right content

                </div>
                <!-- end project-detail sidebar -->

            </div>
        </div>
    </div>
</div>
<script>
    var toolbarOptions = [
        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

        ['bold', 'italic', 'link', 'image'],        // toggled buttons
        ['blockquote', 'code-block'],

        [{ 'list': 'ordered' }, { 'list': 'bullet' }, { 'align': [] }],


    ]


    var quill = new Quill('#body', {
        modules: { toolbar: toolbarOptions },
        theme: 'snow'
    })

    //forum upvote
    $(".fupvote").click(function () {
        var idString = $(this).attr("updateid");
        var forumid = parseInt(idString.split("-")[1]);
        ForumUpVote(forumid)
        //alert(forumid)
    })
    //forum downvote
    $(".fdownvote").click(function () {
        var idString = $(this).attr("updateid");
        var forumid = parseInt(idString.split("-")[1]);
        ForumDownVote(forumid)
        //alert(forumid)
    })
    //thread upvote
    $(".tupvote").click(function () {
        var idString = $(this).attr("updateid");
        var threadid = parseInt(idString.split("-")[1]);
        ThreadUpVote(threadid)
        //alert(threadid)
    })
    //thread downvote
    $(".tdownvote").click(function () {
        var idString = $(this).attr("updateid");
        var threadid = parseInt(idString.split("-")[1]);
        ThreadDownVote(threadid)
        //alert(threadid)
    })

    //add thread
    $("#postanswer").click(() => {
        var body = $(".ql-editor").html()
        if (body.length >= 100) {
            alert("in")
             AddThread();
        }
        else {
            //validation err
        }
    });
    //edit forum
    $(".editforum").click(function () {
        var forumid = $(this).attr("updateid");
        alert(forumid)
    })
    //delete forum
    $(".deleteforum").click(function () {
        var forumid = $(this).attr("updateid");
        var confirm = window.confirm("Really delete this Question?");
        if (confirm == true) {
            alert(forumid)
        }
    })
    //edit thread
    $(".editthread").click(function () {
        var threadid = $(this).attr("updateid");
        alert(threadid)
    })
    //delete thread
    $(".deletethread").click(function () {
        var threadid = $(this).attr("updateid");
        var confirm = window.confirm("Really delete this post?");
        if (confirm == true) {
            alert(threadid)
        }
       
    })

    //open comment div
    $(".opencommentbox").click(function () {
        var threadid = parseInt($(this).attr("updateid"));
        $("#commentbox" + threadid).css('display', 'block')
        //alert(threadid)
    })
    //add comment
    $(".addcomment").click(function () {
        var threadid = $(this).attr("updateid");
        alert(threadid)
    })
    //hide comment div
    $(".cancelcomment").click(function () {
        var threadid = parseInt($(this).attr("updateid"));
        $("#commentbox" + threadid).css('display', 'none')
       // alert(threadid)
    })
    //delete comment
    $(document).on('click', '.deletecomment', function () {
        var threadid = $(this).attr("updateid");
        var confirm = window.confirm("Really delete this comment?");
        if (confirm == true) {
            alert(threadid)
        }
    });

    
    




    function AddThread() {
        alert("in2")
        var obj = {
            thread: {
                ParentThreadId:0,
                Body: $(".ql-editor").html(),
                ForumId:@Model.forum.Id,
                UserId:@Model.Id
            }
        }

        $.ajax({
            url: "/Question/AddThread",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {
                console.log(err);
            }
        });
    }

    function EditThread() {
        var obj = {

        }

        $.ajax({
            url: "/Question/EditThread",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {

            }
        });
    }

    function DeleteThread() {
        var obj = {

        }

        $.ajax({
            url: "/Question/DeleteThread",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {

            }
        });
    }

    function AddComment() {
        var obj = {

        }

        $.ajax({
            url: "/Question/AddComment",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {

            }
        });
    }

    function DeleteComment() {
        var obj = {

        }

        $.ajax({
            url: "/Question/DeleteComment",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {

            }
        });
    }


    function ThreadUpVote(threadid) {
        var obj = {
            ThreadId: threadid
        }

        $.ajax({
            url: "/Question/ThreadUpVote",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {

            }
        });
    }

    function ThreadDownVote(threadid) {
        var obj = {
            ThreadId: threadid
        }

        $.ajax({
            url: "/Question/ThreadDownVote",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {

            }
        });
    }

    function ForumUpVote(forumid) {
        var obj = {
            ForumId: forumid
        }

        $.ajax({
            url: "/Question/ForumUpVote",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            //1-add
            //2-delete
            //3-update
            //4-none
            },
            error: function (err) {

            }
        });
    }

    function ForumDownVote(forumid) {
        var obj = {
            ForumId: forumid
        }

        $.ajax({
            url: "/Question/ForumDownVote",
            method: "POST",
            data: JSON.stringify(obj),
            contentType: "application/json",
            cache: false,
            success: function (res) {
                console.log(res);
            },
            error: function (err) {

            }
        });
    }




</script>